package ru.nsu.tumilevich;import org.junit.jupiter.api.Test;import static org.junit.jupiter.api.Assertions.assertEquals;import static org.junit.jupiter.api.Assertions.assertThrows;public class ExpressionTest {	// Тесты для ExpressionUtils	@Test	void expressionUtilsEvalTest() {		Expression e = new Number(5);		// Проверка корректного парсинга		int result = ExpressionUtils.eval(e, "x = 10; y = 13");		assertEquals(5, result);		// Проверка пустого контекста		result = ExpressionUtils.eval(e, "");		assertEquals(5, result);		// Проверка невалидного контекста (должно упасть при Integer.parseInt)		assertThrows(NumberFormatException.class, () -> {			ExpressionUtils.eval(e, "x = ten");		});		// Проверка невалидного формата (должно проигнорироваться)		result = ExpressionUtils.eval(e, "x = 10; invalid_pair");		assertEquals(5, result);	}	// Тесты для Add, Sub, Mul, Div	@Test	void binaryOperationsTest() {		// Add: 5 + 3 = 8		Expression add = new Add(new Number(5), new Number(3));		assertEquals(8, ExpressionUtils.eval(add, ""));		assertEquals("(5 + 3)", add.toString());		// Sub: 5 - 3 = 2		Expression sub = new Sub(new Number(5), new Number(3));		assertEquals(2, ExpressionUtils.eval(sub, ""));		assertEquals("(5 - 3)", sub.toString());		// Mul: 5 * 3 = 15		Expression mul = new Mul(new Number(5), new Number(3));		assertEquals(15, ExpressionUtils.eval(mul, ""));		assertEquals("(5 * 3)", mul.toString());		// Div: 6 / 3 = 2		Expression div = new Div(new Number(6), new Number(3));		assertEquals(2, ExpressionUtils.eval(div, ""));		assertEquals("(6 / 3)", div.toString());		// Div by zero		Expression divByZero = new Div(new Number(6), new Number(0));		assertThrows(ArithmeticException.class, () -> {			ExpressionUtils.eval(divByZero, "");		});	}	// Тесты для производных Add, Sub, Mul, Div	@Test	void binaryOperationsDerivativeTest() {		Expression x = new Variable("x");		Expression y = new Variable("y");		Expression num5 = new Number(5);		// Add: d/dx (x + 5) = 1 + 0 = 1		Expression add = new Add(x, num5);		assertEquals("(1 + 0)", add.derivative("x").toString());		// Add: d/dy (x + 5) = 0 + 0 = 0		assertEquals("(0 + 0)", add.derivative("y").toString());		// Sub: d/dx (x - 5) = 1 - 0 = 1		Expression sub = new Sub(x, num5);		assertEquals("(1 - 0)", sub.derivative("x").toString());		// Sub: d/dy (x - 5) = 0 - 0 = 0		assertEquals("(0 - 0)", sub.derivative("y").toString());		// Mul: d/dx (x * 5) = 1 * 5 + x * 0 = 5		Expression mul = new Mul(x, num5);		assertEquals("((1 * 5) + (x * 0))", mul.derivative("x").toString());		// Mul: d/dy (x * 5) = 0 * 5 + x * 0 = 0		assertEquals("((0 * 5) + (x * 0))", mul.derivative("y").toString());		// Div: d/dx (x / 5) = (1 * 5 - x * 0) / (5 * 5) = 5 / 25		Expression div = new Div(x, num5);		assertEquals("(((1 * 5) - (x * 0)) / (5 * 5))", div.derivative("x").toString());		// Div: d/dy (x / 5) = (0 * 5 - x * 0) / (5 * 5) = 0 / 25		assertEquals("(((0 * 5) - (x * 0)) / (5 * 5))", div.derivative("y").toString());	}	// Тесты для Number	@Test	void numberTest() {		Expression num = new Number(10);		assertEquals(10, ExpressionUtils.eval(num, ""));		assertEquals("10", num.toString());		assertEquals("0", num.derivative("x").toString());	}	// Тесты для Variable	@Test	void variableTest() {		Expression varX = new Variable("x");		Expression varY = new Variable("y");		// Eval		assertEquals(5, ExpressionUtils.eval(varX, "x = 5"));		assertEquals(0, ExpressionUtils.eval(varX, "")); // Переменная не найдена, должно быть 0		// toString		assertEquals("x", varX.toString());		// Derivative		assertEquals("1", varX.derivative("x").toString()); // d/dx (x) = 1		assertEquals("0", varX.derivative("y").toString()); // d/dy (x) = 0	}	// Тесты для ExpressionParser	@Test	void parserTest() throws Exception {		ExpressionParser parser = new ExpressionParser();		// Простые выражения		assertEquals("(3 + 2)", parser.parse("(3 + 2)").toString());		assertEquals("(x * 5)", parser.parse("(x * 5)").toString());		// Сложные выражения		assertEquals("(((x * x) + (2 * x)) + 1)", parser.parse("(((x * x) + (2 * x)) + 1)").toString());		assertEquals("((x + 1) / (x - 1))", parser.parse("((x + 1) / (x - 1))").toString());	}}